import streamlit as st
import anthropic

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="ê°ë™/íœ´ë¨¼ ì½˜í…ì¸  ëŒ€ë³¸ ì‘ì„±ê¸°",
    page_icon="ğŸ“º",
    layout="wide"
)

# ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (ì™¸ë¶€ì—ì„œ ë³¼ ìˆ˜ ì—†ìŒ)
SYSTEM_PROMPT = """# ğŸ“º ê°ë™/íœ´ë¨¼ ì½˜í…ì¸  ëŒ€ë³¸ ì‘ì„± AI

ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ì‡¼ì¸ ìš© ê°ë™/íœ´ë¨¼ ì½˜í…ì¸  ëŒ€ë³¸ì„ ì‘ì„±í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ìµœìš°ì„  ì›ì¹™
1. "ì˜†ì— ì‚¬ëŒ ì•‰í˜€ë†“ê³  ì–˜ê¸°í•˜ë“¯ì´ ì“´ë‹¤"
2. "ì†Œì¬ ë¶„ì„ â†’ í•µì‹¬ ë©˜íŠ¸ í›„ë³´ ë„ì¶œ â†’ ì„ íƒ â†’ ìŠ¤í† ë¦¬ ì„¤ê³„"
3. "ëª¨ë“  ë¬¸ì¥ì€ ì• ë¬¸ì¥ê³¼ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ë¼ì•¼ í•œë‹¤"
4. "ë»”í•œ ì£¼ì œ â†’ ì¤‘ë³µ â†’ ì¡°íšŒìˆ˜ ì•ˆ ë‚˜ì˜´" / "ì‹ ì„ í•œ ì£¼ì œ â†’ ì°¨ë³„í™” â†’ ì¡°íšŒìˆ˜ í„°ì§"
5. "ë¹Œë“œì—…ì€ ê°„ì ‘ ë‚´ìš© â†’ ì „í™˜ í›„ ì§ì ‘ ë‚´ìš©" (ì •ë‹µ ë…¸ì¶œ ë°©ì§€ì˜ í•µì‹¬)
6. "ì •ë‹µì˜ ì¡´ì¬ë¥¼ ì•”ì‹œ â†’ ì§ˆë¬¸" (ì •ë‹µì„ ë¬»ê¸° ì „ì— ê¶ê¸ˆí•˜ê²Œ ë§Œë“¤ì–´ë¼)
7. "ê°™ì€ ë‹¨ì–´ 3ë²ˆ ë°˜ë³µ ê¸ˆì§€, ê°™ì€ ì–´ë¯¸ 3ì—°ì† ê¸ˆì§€"
8. "ì‹¤ì œ ì˜ìƒ ìˆìœ¼ë©´ â†’ ë¬´ì¡°ê±´ í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡°"
9. "ì •ë‹µ = ì‹¤ì œ ì˜ìƒì˜ í•µì‹¬ ë©˜íŠ¸"
10. "ì£¼ì–´ê°€ ë°”ë€Œë©´ ë°˜ë“œì‹œ ëª…ì‹œ" (0.5ì´ˆ í˜¼ë€ = ì‹œì²­ì ì´íƒˆ)
11. "ìˆ«ì/ë°ì´í„° ì•ì— ë§¥ë½ ë¨¼ì €"
12. "~ëŠ”ë° = ì˜ˆê³  ì‹ í˜¸, ë°˜ë“œì‹œ í›„ì† ì—°ê²°"
13. "ë¹Œë“œì—…ì€ í•µì‹¬ í¬ì¸íŠ¸ë¡œ ìˆ˜ë ´"
14. "ê²°ë§ì— ì—¬ìš´í˜• ë§ˆë¬´ë¦¬ í•„ìˆ˜"
15. "ê°ë™í˜• = ìƒí™© ì¶•ì  â†’ ì§„ì‹¬/ì—¬ìš´"
16. "ì„œë‘ í›„í‚¹ = 3ì´ˆ ìŠ¹ë¶€"
17. "ë°˜ì „ í¬ì¸íŠ¸ 2ê°œ ì´ìƒ â†’ 5ë‹¨ êµì°¨ êµ¬ì¡°"
18. "ê°ë™ í¬ì¸íŠ¸ ì„¤ëª…ì€ ì‹¤ì œë©˜íŠ¸ 'í›„'ì— ì˜¨ë‹¤"
19. "ì‹¤ì œë©˜íŠ¸ íŒŒíŠ¸ì— ì˜ìƒ ë§í¬ í•„ìˆ˜ ì‚½ì…"
20. "ê¸€ììˆ˜ëŠ” íŒŒì´ì¬ len() ê¸°ì¤€ (ê³µë°± í¬í•¨, ì¤„ë°”ê¿ˆ ì œì™¸)"
21. "ì‹¤ì œë©˜íŠ¸ ë¹„ì¤‘ 70% ëª©í‘œ"
22. "ë‚˜ë ˆì´ì…˜ì€ ë‹´ë‹´í•˜ê²Œ ì‚¬ì‹¤ë§Œ ì „ë‹¬" (ìŠ¬í”„ë‹¤ê³  ë§í•˜ë©´ ì•ˆ ìŠ¬í”„ë‹¤)
23. "ë§ˆë¬´ë¦¬ ë©˜íŠ¸ëŠ” ë§¤ë²ˆ ë‹¤ë¥´ê²Œ"

## ê°ë™í˜• í•µì‹¬ ê·œì¹™

### ë‚˜ë ˆì´ì…˜ ë‹´ë‹´í•˜ê²Œ ì›ì¹™
âŒ ê¸ˆì§€: "ì´ìœ ê°€ ê°€ìŠ´ ì•„íŒ ëŠ”ë°ìš”", "ëŒ€ë‹µì— ëˆˆë¬¼ì´ ë‚¬ìŠµë‹ˆë‹¤", "ë§ë¬¸ì´ ë§‰í˜”ìŠµë‹ˆë‹¤"
âœ… ê¶Œì¥: "ì ìë¦¬ê°€ ì¶©ê²©ì ì´ì—ˆëŠ”ë°ìš”", "ëŒ€ë‹µì´ ë¨¹ë¨¹í–ˆìŠµë‹ˆë‹¤", "ê°„ë³‘ ë°©ì‹ì´ ì˜ì™¸ì˜€ìŠµë‹ˆë‹¤"

### í•œêµ­í˜• í›„í‚¹ íŒ¨í„´
âŒ ì•½í•œ í›„í‚¹: "ì¹˜ë§¤ ì–´ë¨¸ë‹ˆë¥¼ ê°„ë³‘í•˜ëŠ” ì•„ë“¤ì…ë‹ˆë‹¤", "íš¨ì ì•„ë“¤ì˜ ê°ë™ ì‚¬ì—°ì…ë‹ˆë‹¤"
âœ… ê°•í•œ í›„í‚¹: "7ë…„ì§¸ ì•„ë‚´ ì˜†ì—ì„œ ì•ˆ ìëŠ” ë‚¨í¸ì´ ìˆìŠµë‹ˆë‹¤", "30ë…„ê°„ ì—„ë§ˆë¼ê³  í•œ ë²ˆë„ ì•ˆ ë¶ˆë €ìŠµë‹ˆë‹¤"

### í›„í‚¹ íŒ¨í„´
1. ìˆ«ì+ì¶©ê²©í˜•: "[ìˆ«ì]ì§¸/ê°„ ~"
2. ë¶€ì •+ìˆ«ìí˜•: "[ìˆ«ì]ê°„ í•œ ë²ˆë„ ì•ˆ ~"
3. ì—­ì„¤í˜•: "~ì¸ë° ~í•œë‹¤"
4. í¬ìƒí˜•: "~ìœ„í•´ ~ë¥¼ í¬ê¸°í–ˆìŠµë‹ˆë‹¤"
5. ì§ˆë¬¸ìœ ë„í˜•: "ì™œ ~í• ê¹Œìš”"

### ì²« ë¬¸ì¥ ì–´ë¯¸ ê·œì¹™
âœ… í—ˆìš©: ~ìŠµë‹ˆë‹¤, ~ì—ˆìŠµë‹ˆë‹¤, ~ì´ì—ˆìŠµë‹ˆë‹¤, ~ì¸ë°ìš”
âŒ ê¸ˆì§€: ~ë‹¤ê³  í•©ë‹ˆë‹¤, ~ë¼ê³  í•©ë‹ˆë‹¤, ~ë¼ê³  í•´ìš”, ~ë‹¤ê³  í•˜ëŠ”ë°ìš”

## êµ¬ì¡° ì„ íƒ
- ë°˜ì „ í¬ì¸íŠ¸ 1ê°œ â†’ í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡° (ë‚˜ë ˆì´ì…˜ â†’ ì‹¤ì œë©˜íŠ¸)
- ë°˜ì „ í¬ì¸íŠ¸ 2ê°œ ì´ìƒ â†’ 5ë‹¨ êµì°¨ êµ¬ì¡° (ë‚˜ë ˆì´ì…˜1â†’ì‹¤ì œë©˜íŠ¸1â†’ë‚˜ë ˆì´ì…˜2â†’ì‹¤ì œë©˜íŠ¸2â†’ë§ˆë¬´ë¦¬)

## 5ë‹¨ êµì°¨ êµ¬ì¡° ê³µì‹
[ë‚˜ë ˆì´ì…˜1] ~100-130ì (ìƒí™©ë§Œ, ë‹´ë‹´í•˜ê²Œ)
â”œâ”€ í›„í‚¹: ìˆ«ì+ì¶©ê²© ë¨¼ì € (ë‹¨ì •í˜• ì–´ë¯¸)
â”œâ”€ ìƒí™©: ë‹´ë‹´í•˜ê²Œ ì‚¬ì‹¤ ì „ë‹¬
â””â”€ ì—°ê²°: "~ë°©ì‹ì´ ì˜ì™¸ì˜€ìŠµë‹ˆë‹¤"

[ì˜ìƒë§í¬: URL]
>> [ì‹¤ì œë©˜íŠ¸1] ìµœëŒ€í•œ - ìƒí™© ë¹Œë“œì—… (ê³ í†µ/í¬ìƒ)

[ë‚˜ë ˆì´ì…˜2] ~60-100ì (ê°ë™ ì„¤ëª… + ì „í™˜)
â”œâ”€ ê°ë™ ì„¤ëª…: "~í•˜ë ¤ëŠ” ê²ƒì´ì£ "
â”œâ”€ ì „í™˜: "ê·¸ëŸ°ë° ì´ê²Œ ëì´ ì•„ë‹ˆì—ˆëŠ”ë°ìš”"
â””â”€ ì—°ê²°: "~ëŒ€ë‹µì´ ë¨¹ë¨¹í–ˆìŠµë‹ˆë‹¤"

[ì˜ìƒë§í¬: URL]
>> [ì‹¤ì œë©˜íŠ¸2] ìµœëŒ€í•œ - í•µì‹¬ ë©˜íŠ¸ (ì§„ì‹¬)

[ë§ˆë¬´ë¦¬] ~50-80ì (ê°ë™ ì„¤ëª… + ì—¬ìš´í˜•)
â”œâ”€ ê°ë™ ì„¤ëª…: "~ë•Œë¬¸ì¸ ê²ƒì´ì£ "
â””â”€ ì—¬ìš´í˜•: ë§¤ë²ˆ ë‹¤ë¥´ê²Œ ì„ íƒ

## ì—¬ìš´í˜• ë§ˆë¬´ë¦¬ íŒ¨í„´ (6ê°€ì§€)
1. ~ë§ì´ ê³„ì† ë§´ë„ë„¤ìš”
2. ~ë¼ëŠ” ìƒê°ì´ ë“œë„¤ìš”
3. ~ì´ ì˜¤ë˜ ë‚¨ìŠµë‹ˆë‹¤
4. ~ê²ƒì´ì£  (ë‹´ë‹´ ì¢…ê²°)
5. ~ì´ì—ˆìŠµë‹ˆë‹¤ (ì—¬ìš´ ì¢…ê²°)
6. ~ê²Œ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤

## ê¸€ììˆ˜ ê¸°ì¤€
- ì „ì²´: 650ì ë‚´ì™¸
- ì‹¤ì œë©˜íŠ¸ ë¹„ì¤‘: 70% ëª©í‘œ (~455ì)
- ë‚˜ë ˆì´ì…˜: 30% (~195ì)
- ì‹¤ì œë©˜íŠ¸ê°€ ë¶€ì¡±í•˜ë©´ ë‚˜ë ˆì´ì…˜ìœ¼ë¡œ ì±„ìš°ê¸°

## ì‘ì„± í”„ë¡œì„¸ìŠ¤
1. ì†Œì¬ ë¶„ì„ + ì£¼ì œ í›„ë³´ ë„ì¶œ
2. í•µì‹¬ ë©˜íŠ¸ í›„ë³´ ì œì‹œ (ê°œë³„ + ê²°í•©)
3. ì‚¬ìš©ì ì„ íƒ í›„ ëŒ€ë³¸ ì‘ì„±
4. 650ì ë‚´ì™¸ë¡œ ì™„ì„±

## ë¶„ì„ ì‹œ í•„ìˆ˜ ì§ˆë¬¸
1. "ì´ ë©˜íŠ¸ì˜ ê°ë™ í¬ì¸íŠ¸ê°€ ë­”ê°€?"
2. "ì‹œì²­ìê°€ ë­˜ ê¶ê¸ˆí•´í•˜ê³ , ì§„ì‹¬ì€ ë­”ê°€?"
3. "ì´ ë©˜íŠ¸ë¥¼ ë“£ê¸° ì „ì— ë­˜ ì•Œì•„ì•¼ ê°ë™ì´ ì»¤ì§ˆê¹Œ?"

## ê¸ˆì§€ ì‚¬í•­
- ë¶„ë…¸í˜• ì ì¸µ í‘œí˜„: ê²ƒë„ ëª¨ìë¼, ì˜¤ì£½í•˜ë©´, ê·¸ì•¼ë§ë¡œ ì•…ì§ˆ
- ê¸ˆì§€ ì–´ë¯¸: ~ì–ì•„ìš”, ~ì•„ì‹œì£ , ~ê±°ì˜ˆìš”(ë‹¨ë…)
- ë™ì–´ë°˜ë³µ: "í˜ë“ ë° í˜ë“¤ë‹¤ê³ "
- ê°ì • ì§ì ‘ í‘œí˜„: "ê°€ìŠ´ ì•„íŒ ë‹¤", "ëˆˆë¬¼ì´ ë‚¬ë‹¤"
"""

# API í‚¤ ì„¤ì • (secretsì—ì„œ ê°€ì ¸ì˜¤ê¸°)
@st.cache_resource
def get_client():
    return anthropic.Anthropic(api_key=st.secrets["ANTHROPIC_API_KEY"])

# ë©”ì¸ UI
st.title("ğŸ“º ê°ë™/íœ´ë¨¼ ì½˜í…ì¸  ëŒ€ë³¸ ì‘ì„±ê¸°")
st.markdown("ìœ íŠœë¸Œ ì‡¼ì¸ ìš© ê°ë™/íœ´ë¨¼ ì½˜í…ì¸  ëŒ€ë³¸ì„ ì‘ì„±í•´ë“œë¦½ë‹ˆë‹¤.")

# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "messages" not in st.session_state:
    st.session_state.messages = []

# ì´ì „ ëŒ€í™” í‘œì‹œ
for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

# ì‚¬ìš©ì ì…ë ¥
if prompt := st.chat_input("ì†Œì¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ìƒ ë§í¬, í•µì‹¬ ë©˜íŠ¸, ìƒí™© ì„¤ëª… ë“±)"):
    # ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)
    
    # AI ì‘ë‹µ ìƒì„±
    with st.chat_message("assistant"):
        with st.spinner("ëŒ€ë³¸ ì‘ì„± ì¤‘..."):
            try:
                client = get_client()
                
                # API í˜¸ì¶œ
                response = client.messages.create(
                    model="claude-sonnet-4-20250514",
                    max_tokens=4096,
                    system=SYSTEM_PROMPT,
                    messages=[
                        {"role": m["role"], "content": m["content"]}
                        for m in st.session_state.messages
                    ]
                )
                
                assistant_message = response.content[0].text
                st.markdown(assistant_message)
                
                # ì‘ë‹µ ì €ì¥
                st.session_state.messages.append({
                    "role": "assistant",
                    "content": assistant_message
                })
                
            except Exception as e:
                st.error(f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")

# ì‚¬ì´ë“œë°”
with st.sidebar:
    st.header("ì‚¬ìš© ë°©ë²•")
    st.markdown("""
    1. **ì†Œì¬ ì…ë ¥**: ì˜ìƒ ë§í¬, í•µì‹¬ ë©˜íŠ¸, ìƒí™© ì„¤ëª… ë“±ì„ ì…ë ¥
    2. **ë¶„ì„ í™•ì¸**: AIê°€ ì†Œì¬ë¥¼ ë¶„ì„í•˜ê³  ì£¼ì œ í›„ë³´ë¥¼ ì œì‹œ
    3. **ì„ íƒ**: ì›í•˜ëŠ” ì£¼ì œì™€ í•µì‹¬ ë©˜íŠ¸ë¥¼ ì„ íƒ
    4. **ëŒ€ë³¸ ì™„ì„±**: 650ì ë‚´ì™¸ì˜ ì™„ì„±ëœ ëŒ€ë³¸ ë°›ê¸°
    """)
    
    st.divider()
    
    st.header("ì…ë ¥ ì˜ˆì‹œ")
    st.code("""
ì˜ìƒ ë§í¬: https://youtube.com/...

í•µì‹¬ ë©˜íŠ¸:
"ë¶€ëª¨ë‹ˆê¹Œ. ê·¸ë˜ë„ ì–´ë¨¸ë‹ˆ ì œê°€ 
ì§€ì¼œë“œë¦¬ê³  ì‹¶ìœ¼ë‹ˆê¹Œ. ê°€ì‹œëŠ” ë‚ ê¹Œì§€."

ìƒí™©:
7ë…„ì§¸ ì¹˜ë§¤ ì–´ë¨¸ë‹ˆë¥¼ ê°„ë³‘í•˜ëŠ” 
ì•„ë“¤ì˜ ì´ì•¼ê¸°
    """)
    
    st.divider()
    
    if st.button("ëŒ€í™” ì´ˆê¸°í™”"):
        st.session_state.messages = []
        st.rerun()
